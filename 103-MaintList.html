<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>XƯỞNG SẢN XUẤT</title>

  <!-- ✅ Chỉ dùng 1 bản Bootstrap để tránh xung đột -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

  <!-- ⚡ Tăng tốc kết nối tới GAS -->
  <link rel="preconnect" href="https://script.google.com" crossorigin>
  <link rel="dns-prefetch" href="https://script.google.com">
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://www.gstatic.com">
  <link rel="dns-prefetch" href="https://ssl.gstatic.com">
  <link rel="dns-prefetch" href="https://accounts.google.com">

  <style>
    /* ===== Cơ bản & mobile ===== */
    html, body { height: 100%; min-height: 100dvh; -webkit-text-size-adjust: 100%; }
    body { background: #121212; color: #fff; }

    /* ===== Header / Nav cố định chiều cao “đo được” ===== */
    .site-header { background:#0d0d0d; }
    .site-title { font-size: clamp(18px, 2.6vw, 28px); }

    /* ===== Khung chứa iframe: cao = 100dvh - (header + nav) ===== */

    .iframe-wrap {
  position: relative;
  width: 100%;
  height: calc(100dvh - var(--header-nav-height, 140px)); /* luôn fill trừ header/nav */
  background: #0b0b0b;
  overflow: hidden;
}
.fast-iframe {
  display: block;
  width: 100%;
  height: 100%;
  border: 0;
  opacity: 0;
  transition: opacity .25s ease;
}
    /* ===== Skeleton loader (hiện trong lúc GAS đang tải) ===== */
    .skeleton {
      position: absolute; inset: 0;
      display: grid; place-items: center;
      background:
        linear-gradient(90deg, rgba(255,255,255,0.04), rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      background-size: 200% 100%;
      animation: shimmer 1.25s infinite linear;
    }
    @keyframes shimmer { 0% {background-position: 200% 0} 100% {background-position: -200% 0} }

    .skeleton .spinner-border { width: 2.5rem; height: 2.5rem; }

    /* ===== Dropdown tối màu đồng bộ ===== */
    .navbar-dark .dropdown-menu { background:#1c1c1c; }
    .dropdown-item { color:#eaeaea; }
    .dropdown-item:hover { background:#2a2a2a; color:#fff; }

    /* ===== Tối ưu chạm trên mobile ===== */
    .btn, .nav-link, .dropdown-item { min-height: 36px; }

    /* Ẩn bớt viền iframe trên theme tối của bạn */
    .shadow-embed { box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset; }
  </style>
</head>
<body>

  <!-- ===== HEADER ===== -->
  <header class="site-header py-2 shadow-sm">
    <div class="container-fluid text-center">
      <h1 class="site-title text-primary m-0">BP CƠ ĐIỆN - LÒ HƠI - MÁY NÉN KHÍ</h1>
    </div>
  </header>

  <!-- ===== NAV ===== -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow">
    <div class="container-fluid">
      <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Menu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbar-content">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" href="https://sangnguyen86.github.io/TLNL/100-Main.html">TRANG CHỦ</a></li>

          <!-- TỔ CƠ ĐIỆN -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-auto-close="outside">TỔ CƠ ĐIỆN</a>
            <ul class="dropdown-menu dropdown-menu-dark shadow">
              <li><a class="dropdown-item" href="https://sangnguyen86.github.io/TLNL/101-TaskList.html">BẢNG CÔNG VIỆC</a></li>
              <li><a class="dropdown-item" href="https://sangnguyen86.github.io/TLNL/102-PlanList.html">KẾ HOẠCH DỰ ÁN</a></li>
              <li><hr class="dropdown-divider"></li>
              <li class="dropend">
                <a class="dropdown-item dropdown-toggle" href="#" data-bs-toggle="dropdown">BÁO CÁO &amp; GHI CHỈ SỐ</a>
                <ul class="dropdown-menu dropdown-menu-dark shadow">
                  <li><a class="dropdown-item" href="https://sangnguyen86.github.io/TLNL/104-TaskReport.html">BÁO CÁO CÔNG VIỆC</a></li>
                  <li><a class="dropdown-item" href="https://sangnguyen86.github.io/TLNL/105-WaterRecord.html">GHI CHỈ SỐ NƯỚC</a></li>
                  <li><a class="dropdown-item" href="https://sangnguyen86.github.io/TLNL/107-MotorRecord.html">GHI CHỈ SỐ DÒNG ĐIỆN</a></li>
                </ul>
              </li>
              <li class="dropend">
                <a class="dropdown-item dropdown-toggle" href="#" data-bs-toggle="dropdown">PHÂN CÔNG</a>
                <ul class="dropdown-menu dropdown-menu-dark shadow">
                  <li><a class="dropdown-item" href="#">CÔNG VIỆC HÀNG NGÀY</a></li>
                  <li><a class="dropdown-item" href="#">PHÂN CÔNG KHÁC</a></li>
                  <li><a class="dropdown-item" href="#">KHÁC</a></li>
                </ul>
              </li>
            </ul>
          </li>

          <!-- TỔ LÒ HƠI -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-auto-close="outside">TỔ LÒ HƠI</a>
            <ul class="dropdown-menu dropdown-menu-dark shadow">
              <li><a class="dropdown-item" href="#">Link 1</a></li>
              <li><a class="dropdown-item" href="#">Link 2</a></li>
              <li><a class="dropdown-item" href="#">Link 3</a></li>
              <li class="dropend">
                <a class="dropdown-item dropdown-toggle" href="#" data-bs-toggle="dropdown">REPORTS</a>
                <ul class="dropdown-menu dropdown-menu-dark shadow">
                  <li><a class="dropdown-item" href="#">Report 1</a></li>
                  <li><a class="dropdown-item" href="#">Report 2</a></li>
                  <li><a class="dropdown-item" href="#">Report 3</a></li>
                </ul>
              </li>
            </ul>
          </li>

          <!-- LINK TRỰC TIẾP -->
          <li class="nav-item"><a class="nav-link" href="https://sangnguyen86.github.io/TLNL/103-MaintList.html">BẢO TRÌ BẢO DƯỠNG</a></li>
          <li class="nav-item"><a class="nav-link" href="https://sangnguyen86.github.io/TLNL/204-Than.html">THAN ĐÁ</a></li>
          <li class="nav-item"><a class="nav-link" href="https://sangnguyen86.github.io/TLNL/106-Suggestion.html">ĐỀ XUẤT VẬT TƯ</a></li>

          <!-- ADMIN -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" data-bs-auto-close="outside">ADMIN</a>
            <ul class="dropdown-menu dropdown-menu-dark shadow">
              <li><a class="dropdown-item" href="https://sangnguyen86.github.io/TLNL/201-AdminTaskList.html">TASK MANAGEMENT</a></li>
              <li><a class="dropdown-item" href="https://sangnguyen86.github.io/TLNL/202-AdminPlanList.html">PLANT MANAGEMENT</a></li>
              <li><a class="dropdown-item" href="https://sangnguyen86.github.io/TLNL/203-AdminMaintList.html">MAINT MANAGEMENT</a></li>
              <li><a class="dropdown-item" href="https://sangnguyen86.github.io/TLNL/204-AdminCoxial.html">NHẬP THAN</a></li>
              <li><a class="dropdown-item" href="https://sangnguyen86.github.io/TLNL/205-AdminSuggestion.html">ĐỀ XUẤT</a></li>
              <li><a class="dropdown-item" href="https://sangnguyen86.github.io/TLNL/210-MachineManagerment.html">MACHINE MANAGEMENT</a></li>
              <li class="dropend">
                <a class="dropdown-item dropdown-toggle" href="#" data-bs-toggle="dropdown">REPORTS</a>
                <ul class="dropdown-menu dropdown-menu-dark shadow">
                  <li><a class="dropdown-item" href="#">Report 1</a></li>
                  <li><a class="dropdown-item" href="#">Report 2</a></li>
                  <li><a class="dropdown-item" href="#">Report 3</a></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>

        <!-- SEARCH -->
        <form class="d-flex ms-auto" role="search">
          <div class="input-group">
            <input class="form-control border-0" type="search" placeholder="Tìm kiếm" aria-label="Search">
            <button class="btn btn-primary border-0" type="submit">Tìm</button>
          </div>
        </form>
      </div>
    </div>
  </nav>

  <!-- ===== NỘI DUNG: IFAME GAS (lazy-load) ===== -->
  <main class="container-fluid p-0">
    <section class="iframe-wrap shadow-embed" id="iframeWrap">
      <!-- Skeleton hiển thị trong khi iframe đang tải -->
      <div class="skeleton" id="skeleton">
        <div class="text-center">
          <div class="spinner-border text-light" role="status" aria-hidden="true"></div>
          <div class="mt-3 text-white-50">Đang tải kế hoạch bảo trì...</div>
        </div>
      </div>

      <!-- Iframe: chỉ gán src khi vào viewport để nhanh trang -->
      <iframe
        id="gasFrame"
        class="fast-iframe"
        title="Kế hoạch bảo trì bảo dưỡng"
        loading="lazy"              <!-- Fallback lazy cho trình duyệt hỗ trợ -->
        referrerpolicy="no-referrer-when-downgrade"
        allow="fullscreen"          <!-- không bắt buộc, nhưng không hại -->
        sandbox="allow-scripts allow-same-origin allow-forms"  <!-- an toàn hơn, ALLOWALL đã đặt ở App -->
      ></iframe>
    </section>
  </main>

  <!-- ✅ Bootstrap JS (khớp 5.3.3) -->
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ===== Đo chiều cao nav + header để set chiều cao thật cho khối iframe =====
    function resizeIframeWrap() {
  const header = document.querySelector('.site-header');
  const nav    = document.querySelector('nav.navbar');
  const hHeader= header ? header.offsetHeight : 0;
  const hNav   = nav ? nav.offsetHeight : 0;
  const total  = hHeader + hNav;

  // đặt biến CSS để iframe-wrap luôn = 100dvh - (header+nav)
  document.documentElement.style.setProperty('--header-nav-height', total + 'px');
}

    // ===== Lazy gán src cho iframe bằng IntersectionObserver =====
    const IFRAME_SRC = "https://script.google.com/macros/s/AKfycbwN8XRC4tan4TxHLtqkd3_Hzifp_s1J3HspnOhHYo6mwiV71CDzDJzk5Pg0t6h0F805/exec";

    function mountIframeWhenVisible() {
      const frame    = document.getElementById('gasFrame');
      const skeleton = document.getElementById('skeleton');

      // Nếu trình duyệt không có IntersectionObserver, gán thẳng src
      if (!('IntersectionObserver' in window)) {
        frame.src = IFRAME_SRC;
        frame.addEventListener('load', () => {
          skeleton.style.display = 'none';
          frame.style.opacity = '1';
        });
        return;
      }

      const io = new IntersectionObserver((entries, obs) => {
        const ent = entries[0];
        if (ent && ent.isIntersecting) {
          frame.src = IFRAME_SRC;           // ⬅️ Chỉ lúc này mới tải GAS
          frame.addEventListener('load', () => {
            skeleton.style.display = 'none';
            frame.style.opacity = '1';
          }, { once: true });
          obs.disconnect();
        }
      }, { root: null, rootMargin: '200px 0px', threshold: 0.01 });

      io.observe(document.getElementById('iframeWrap'));
    }

    // ===== Khởi động sau khi DOM sẵn sàng =====
    function ready(fn){ document.readyState !== 'loading' ? fn() : document.addEventListener('DOMContentLoaded', fn); }

    ready(() => {
      resizeIframeWrap();
      mountIframeWhenVisible();

      // Cập nhật khi đổi kích cỡ hoặc đổi hướng
      window.addEventListener('resize', resizeIframeWrap);
      window.addEventListener('orientationchange', () => setTimeout(resizeIframeWrap, 200));
    });
  </script>
</body>
</html>
